#!/usr/bin/env bash
set -eu

if [ -z "$1" ]; then
  echo "Missing version argument; this script should be invoked as:"
  echo "$ ./dev/bump-version M.N.P"
  exit 1
fi

yarn version --no-git-tag-version --new-version $1
npx github-changes --only-pulls --branch main --owner sourcegraph --repository lsif-typescript --title "LSIF Typescript" --tag-name "v$1"
git add .
TITLE="Update ChangeLog and bump version for releasing $1."
git commit -m "$TITLE"
gh pr create --base main --title "$TITLE" --body "\n### Test plan\nRan automated tests." --repo sourcegraph/lsif-typescript
echo "---------------------------------------------------------------------"
echo "Don't forget to push a version tag v$1 to main once the PR is merged!"
echo "---------------------------------------------------------------------"
